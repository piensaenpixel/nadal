<!DOCTYPE HTML>

<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Nadal</title>
    <!-- Include CARTO VL JS -->
    <script src="js/carto-vl.js"></script>
    <!-- Include Mapbox GL JS -->
    <script src="js/mapbox-gl-dev.js"></script>
    <!-- Include Mapbox GL CSS -->
    <link href="css/mapbox-gl-dev.css" rel="stylesheet" />

		<link href="css/reset.css" type="text/css" rel="stylesheet" />
    <link href="css/app.css" type="text/css" rel="stylesheet" />
    <link href="css/perfect-scrollbar.css" rel="stylesheet">
    <script src="js/perfect-scrollbar.min.js"></script>

	</head>

	<body>
		 <section id="home">
		 	<div class="home-inner">
		 		<h2 class="home-subtitle">
          <img src="img/logo-nadal.png" alt="About" />
        </h2>
		 		<h1 class="home-title">Rafa Nadal</h1>
		 		<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper.</p>
		 		<p class="button" id="continue"><a href="#">Continue</a></p>
		 	</div>


		 </section>

		 <section id="map_inner">



	 		<div class="timeline">
	 			<span id="bar">

             <div class="map-info">
                <iframe id="media" width="462" height="240" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <div class="map-infoText">
                  <span id="year"></span>
                  <h2 id="title"></h2>
                  <div class="scroll">
                    <p id="description"></p>
                  </div>
                </div>



<!--                 <ul class="navigation">
                  <li id="prev">
                    <svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <path d="M13.0014918,8.99984838 L0.93065281,8.99984838 L0.93065281,6.99988628 L13.0014729,6.99988628 L8.63435917,2.63277257 C8.25271742,2.25113081 8.24709663,1.61235705 8.63761352,1.22184016 C9.03085302,0.828600653 9.65982637,0.829866243 10.0485459,1.21858581 L15.7118017,6.88184154 C16.0082814,7.17832129 16.077832,7.62998058 15.911022,7.99987681 C16.077832,8.36977304 16.0082814,8.82143233 15.7118017,9.11791207 L10.0485459,14.7811678 C9.65982637,15.1698874 9.03085302,15.171153 8.63761352,14.7779135 C8.24709663,14.3873966 8.25271742,13.7486228 8.63435917,13.3669811 L13.0014918,8.99984838 Z" id="Combined-Shape-Copy" fill="#fff" transform="translate(8.465194, 7.999877) scale(-1, 1) translate(-8.465194, -7.999877) "></path>
                        </g>
                    </svg>
                  </li>
                  <li id="next">
                    <svg width="16px" height="14px" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <path d="M3.0729291,5.99988628 L15.9996968,5.99988628 L15.9996968,7.99984838 L3.42266415,7.99984838 L7.37229321,11.9494774 C7.75393496,12.3311192 7.75955575,12.969893 7.36903886,13.3604099 C6.97579936,13.7536494 6.34682601,13.7523838 5.95810645,13.3636642 L0.294850712,7.70040846 C0.0608748934,7.46643264 -0.0317683584,7.13581028 0.0215565178,6.82499981 C-0.0317683584,6.51418934 0.0608748934,6.18356697 0.294850712,5.94959116 L5.95810645,0.286335419 C6.34682601,-0.102384144 6.97579936,-0.103649734 7.36903886,0.289589768 C7.75955575,0.680106658 7.75393496,1.31888043 7.37229321,1.70052218 L3.0729291,5.99988628 Z" id="path-next"></path>
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <use id="Combined-Shape" fill="#fff" transform="translate(7.999848, 6.825000) scale(-1, 1) translate(-7.999848, -6.825000) " xlink:href="#path-next"></use>
                        </g>
                    </svg>
                  </li>
                </ul> -->
              </div>


        </span>
	 		</div>
      
      <div id="map"></div>




    </section>

    <script src="js/nadal.js"></script>

    <script>
  /* map */
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
    center: [3.1975198, 39.5699649],
    zoom: 10,
    dragRotate: false
  });
  

      carto.setDefaultAuth({
        user: 'piensaenpixel',
        apiKey: 'default_public'
      });
      const s = carto.expressions;
      const source = new carto.source.Dataset('nadal');
      const viz = new carto.Viz(`
        width: 6
        color: ramp($infowindow,Prism)
        resolution: 0.2
        strokeWidth: 18;
        strokeColor: rgba(245, 166, 35, .2)
      `);

      const layer = new carto.Layer('layer', source, viz);
      layer.addTo(map, 'watername_ocean');


  /* vars */
  var position = 1;
  var data;
  var elNext = document.getElementById("next");
  var elPrev = document.getElementById("prev");


  /* read json */
  var request = new XMLHttpRequest();
  request.open('GET', 'nadal.json', true);
  request.onload = function() {
    if (request.status >= 200 && request.status < 400) {
      // Success!
      data = JSON.parse(request.responseText);
      init();
    } else {
      // We reached our target server, but it returned an error
    }
  };
  request.onerror = function() {
    // There was a connection error of some sort
  };

  request.send();

  /* Functions change content */
  function updateContent(value) {

      var media = document.getElementById("media");
      console.log(media);
      document.getElementById("year").innerHTML = data[value].FIELD9;
      document.getElementById("title").innerHTML = data[value].FIELD3;
      document.getElementById("description").innerHTML = data[value].FIELD4;
      if (data[value].FIELD8 != "") {
         if (media.classList.contains('empty')) {
           media.classList.remove('empty');
          }
        media.src = data[value].FIELD8;
      } else {
        media.classList.add('empty');
      }
      

      var coordinates = data[value].FIELD1.split(", ");
      map.flyTo({
            center: [coordinates[0], coordinates[1]]
      });

      console.log(coordinates);
      console.log(data[value].FIELD1);
      console.log(data[value].FIELD9);

      var width =  window.outerWidth;
      var step = (width / data.length) * (value + 1);
      console.log(width);
      console.log(step);
      document.getElementById("bar").style.width = step + 'px';
  }

  function next(){
    if (position < data.length) {
      position = position +1;
      updateContent(position);
    }
  }

  function prev(){
    if (position > 1) {
      position = position - 1;
      updateContent(position);
    }
  }

  function init(){
      elNext.addEventListener("click", function(){
        next()
      }, false); 
      elPrev.addEventListener("click", function(){
        prev();
      }, false); 
  }

  function checkKey(e) {
      e = e || window.event;
      if (e.keyCode == '37') {
        prev();
      }
      else if (e.keyCode == '39') {
        next();
      }
  }


  /* Change content */

  document.addEventListener("DOMContentLoaded", function() {
    setTimeout(function() {
      updateContent(position)
    }, 500);
  });

  document.onkeydown = checkKey;

  var ps = new PerfectScrollbar('.scroll');



</script>


  </body>

</html>
