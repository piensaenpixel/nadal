<!DOCTYPE HTML>

<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Nadal</title>
    <!-- Include CARTO VL JS -->
    <script src="js/carto-vl.js"></script>
    <!-- Include Mapbox GL JS -->
    <script src="js/mapbox-gl-dev.js"></script>
    <!-- Include Mapbox GL CSS -->
    <link href="css/mapbox-gl-dev.css" rel="stylesheet" />

		<link href="css/reset.css" type="text/css" rel="stylesheet" />
    <link href="css/app.css" type="text/css" rel="stylesheet" />

    <style type="text/css">
        #map {
          position: absolute;
          top: 0;
          right: 0;
          bottom: 0;
          left: 0;
        }
        .map-info {
          background: rgba(255, 255, 255, .8);
          position: absolute;
          right: 0;
          bottom: 0;
          left: 0;
          padding: 20px;
          z-index: 2;
          color: #000;
        }
    </style>

	</head>

	<body>
		 <section id="home" class="h-valign h-txt-center">
		 	<div class="h-iblock home-inner h-malign">
		 		<h2 class="h-tupper home-subtitle"><span class="h-pr h-iblock">About</span></h2>
		 		<h1 class="h-tupper home-title">Rafa Nadal</h1>
		 		<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper.</p>
		 		<p class="button h-tupper" id="continue"><a href="#">Continue</a></p>
		 	</div>


		 </section>

		 <section id="map_inner">
      <!--
		 	<div class="inner-timeline">

		 		<div class="timeline h-pr">
		 			<span class="h-pa"></span>
		 		</div>
		 	</div>-->
      <div id="map"></div>
      <div class="map-info">
        <h2 id="title"></h2>
        <p id="description"></p>
        <p id="next">next</p>
        <p id="prev">prev</p>
      </div>


      <iframe id="media" width="560" height="315" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

    </section>

    <script src="js/nadal.js"></script>

    <script>
  /* map */
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
    center: [3.1975198, 39.5699649],
    zoom: 10,
    dragRotate: false
  });
  

      carto.setDefaultAuth({
        user: 'piensaenpixel',
        apiKey: 'default_public'
      });
      const s = carto.expressions;
      const source = new carto.source.Dataset('nadal');
      const viz = new carto.Viz(`
        width: 6
        color: #ff5500
        resolution: 0.1
      `);

      const layer = new carto.Layer('layer', source, viz);

      layer.addTo(map, 'watername_ocean');



  /* vars */
  var position = 1;
  var data;
  var elNext = document.getElementById("next");
  var elPrev = document.getElementById("prev");

  /* read json */
  var request = new XMLHttpRequest();
  request.open('GET', 'nadal.json', true);
  request.onload = function() {
    if (request.status >= 200 && request.status < 400) {
      // Success!
      data = JSON.parse(request.responseText);
      init();
    } else {
      // We reached our target server, but it returned an error
    }
  };
  request.onerror = function() {
    // There was a connection error of some sort
  };

  request.send();

  /* Functions change content */
  function updateContent(value) {
      document.getElementById("title").innerHTML = data[value].FIELD3;
      document.getElementById("description").innerHTML = data[value].FIELD4;
      document.getElementById("media").src = data[value].FIELD8;

      var coordinates = data[value].FIELD1.split(", ");
      map.flyTo({
            center: [coordinates[0], coordinates[1]]
      });

      console.log(coordinates);
      console.log(data[value].FIELD1);
  }

  function next(){
    if (position < data.length) {
      position = position +1;
      updateContent(position);
    }
  }

  function prev(){
    if (position > 1) {
      position = position - 1;
      updateContent(position);
    }
  }

  function init(){
      elNext.addEventListener("click", function(){
        next()
      }, false); 
      elPrev.addEventListener("click", function(){
        prev();
      }, false); 
  }

  function checkKey(e) {
      e = e || window.event;
      if (e.keyCode == '37') {
        prev();
      }
      else if (e.keyCode == '39') {
        next();
      }
  }


  /* Change content */

  document.addEventListener("DOMContentLoaded", function() {
    setTimeout(function() {
      updateContent(position)
    }, 500);
  });

  document.onkeydown = checkKey;




</script>


  </body>

</html>
